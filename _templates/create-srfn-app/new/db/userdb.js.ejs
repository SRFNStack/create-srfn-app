---
to: "<%=userApiEnabled ? `${appName}/db/userdb.js` : null%>"
---
const { db } = require('./db')

const usersCollection = stuffId => `users-${stuffId}`
const usersTransactionsKey = userId => `user-transactions-${userId}`
const rewardItemsCollection = userId => `rewardMenu-${userId}`
const handleNotFound = ( obj ) => {
    if( !obj ) throw { statusCode: 404, statusMessage: 'Not Found' }
    else return obj
}

const ensureValidUser = ( user, userId ) => {
    if( user.userId !== userId ) {
        throw { status: 400, message: 'Bad Request: userId mismatch' }
    }
    if( !user.name ) {
        throw { status: 400, message: 'Bad Request: name is required' }
    }
    return user
}

module.exports = {
    getUsers: async ( userId, page, size ) => await db.findAll( usersCollection( userId ), page, size ),
    getUser: async ( userId ) => await db.findOneById( userId ),
    saveUser: async ( user, userId ) => await db.save( ensureValidUser(user), usersCollection( userId ) ),
    deleteUser: async ( userId ) => await db.deleteById( userId, usersCollection( userId ) ),
}